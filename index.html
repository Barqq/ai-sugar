<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إدارة مرض السكري - نظام التنبؤ والمتابعة</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="container">
                <h1>🩺 إدارة مرض السكري</h1>
                <nav class="header-nav">
                    <button class="btn btn--outline btn--sm" id="settings-btn">⚙️ الإعدادات</button>
                    <button class="btn btn--outline btn--sm" id="history-btn">📊 السجل</button>
                    <button class="btn btn--outline btn--sm" id="data-btn">💾 البيانات</button>
                </nav>
            </div>
        </header>

        <main class="main-content">
            <div class="container">
                <!-- Welcome Screen -->
                <section id="welcome-screen" class="screen active">
                    <div class="welcome-card card">
                        <div class="card__body">
                            <h2>مرحباً بك في نظام إدارة مرض السكري</h2>
                            <p>نظام ذكي للتنبؤ بمستوى السكر في الدم وحساب جرعة الأنسولين المناسبة</p>
                            
                            <div class="features-grid">
                                <div class="feature-item">
                                    <span class="feature-icon">🔮</span>
                                    <h3>التنبؤ الذكي</h3>
                                    <p>توقع مستوى السكر خلال 4 ساعات</p>
                                </div>
                                <div class="feature-item">
                                    <span class="feature-icon">💊</span>
                                    <h3>حساب الأنسولين</h3>
                                    <p>احسب الجرعة المناسبة تلقائياً</p>
                                </div>
                                <div class="feature-item">
                                    <span class="feature-icon">🥗</span>
                                    <h3>قاعدة بيانات شاملة</h3>
                                    <p>أكثر من 50 نوع طعام مع معلومات مفصلة</p>
                                </div>
                                <div class="feature-item">
                                    <span class="feature-icon">📈</span>
                                    <h3>تتبع النتائج</h3>
                                    <p>احفظ وراجع تنبؤاتك السابقة</p>
                                </div>
                            </div>

                            <div class="medical-disclaimer">
                                <h4>⚠️ إخلاء طبي مهم</h4>
                                <p>هذا النظام لأغراض تعليمية فقط ولا يغني عن استشارة طبيب مختص. استشر طبيبك دائماً قبل تعديل جرعات الأنسولين.</p>
                            </div>

                            <button class="btn btn--primary btn--lg btn--full-width" id="start-btn">
                                ابدأ الآن ← 
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Step 1: Personal Information -->
                <section id="step-1" class="screen">
                    <div class="step-header">
                        <div class="step-indicator">
                            <span class="step-number">1</span>
                            <span class="step-title">المعلومات الشخصية</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 25%"></div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card__body">
                            <form id="personal-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">العمر (سنة)</label>
                                        <input type="number" class="form-control" id="age" min="18" max="100" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">نوع السكري</label>
                                        <select class="form-control" id="diabetes-type" required>
                                            <option value="">اختر النوع</option>
                                            <option value="type1">النوع الأول</option>
                                            <option value="type2">النوع الثاني</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">الوزن (كيلوجرام)</label>
                                        <input type="number" class="form-control" id="weight" min="30" max="200" step="0.1" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">الطول (سم)</label>
                                        <input type="number" class="form-control" id="height" min="120" max="220" required>
                                    </div>
                                </div>

                                <div class="bmi-display" id="bmi-display" style="display: none;">
                                    <h4>مؤشر كتلة الجسم (BMI)</h4>
                                    <div class="bmi-value" id="bmi-value"></div>
                                    <div class="bmi-category" id="bmi-category"></div>
                                </div>

                                <div class="step-actions">
                                    <button type="button" class="btn btn--outline" id="back-to-welcome">← السابق</button>
                                    <button type="submit" class="btn btn--primary">التالي →</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </section>

                <!-- Step 2: Current Status -->
                <section id="step-2" class="screen">
                    <div class="step-header">
                        <div class="step-indicator">
                            <span class="step-number">2</span>
                            <span class="step-title">الحالة الحالية</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 50%"></div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card__body">
                            <form id="status-form">
                                <div class="form-group">
                                    <label class="form-label">مستوى السكر الحالي (mg/dL)</label>
                                    <input type="number" class="form-control" id="current-bg" min="50" max="500" required>
                                    <div class="glucose-meter" id="glucose-meter">
                                        <div class="glucose-scale">
                                            <div class="scale-marker low">70</div>
                                            <div class="scale-marker normal">120</div>
                                            <div class="scale-marker high">180</div>
                                            <div class="scale-marker danger">250</div>
                                        </div>
                                        <div class="glucose-indicator" id="glucose-indicator"></div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">الوقت منذ آخر وجبة</label>
                                    <div class="time-slider-container">
                                        <input type="range" class="time-slider" id="time-since-meal" min="0" max="6" step="0.5" value="0">
                                        <div class="time-labels">
                                            <span>الآن</span>
                                            <span>1 ساعة</span>
                                            <span>2 ساعة</span>
                                            <span>3 ساعات</span>
                                            <span>4 ساعات</span>
                                            <span>5 ساعات</span>
                                            <span>6+ ساعات</span>
                                        </div>
                                        <div class="time-display" id="time-display">الآن - لم آكل بعد</div>
                                    </div>
                                </div>

                                <div class="step-actions">
                                    <button type="button" class="btn btn--outline" id="back-to-step-1">← السابق</button>
                                    <button type="submit" class="btn btn--primary">التالي →</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </section>

                <!-- Step 3: Food Selection -->
                <section id="step-3" class="screen">
                    <div class="step-header">
                        <div class="step-indicator">
                            <span class="step-number">3</span>
                            <span class="step-title">اختيار الطعام</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 75%"></div>
                        </div>
                    </div>

                    <div class="food-selection-container">
                        <!-- Search and Filters -->
                        <div class="card food-search-card">
                            <div class="card__body">
                                <div class="search-container">
                                    <input type="text" class="form-control" id="food-search" placeholder="ابحث عن طعام...">
                                </div>
                                
                                <div class="category-filters">
                                    <button class="filter-btn active" data-category="all">الكل</button>
                                    <button class="filter-btn" data-category="فواكه">🍎 فواكه</button>
                                    <button class="filter-btn" data-category="حبوب">🍞 حبوب</button>
                                    <button class="filter-btn" data-category="خضروات">🥕 خضروات</button>
                                    <button class="filter-btn" data-category="ألبان">🥛 ألبان</button>
                                    <button class="filter-btn" data-category="بقوليات">🫛 بقوليات</button>
                                    <button class="filter-btn" data-category="حلويات">🍰 حلويات</button>
                                    <button class="filter-btn" data-category="مشروبات">🧃 مشروبات</button>
                                </div>
                            </div>
                        </div>

                        <div class="food-grid-container">
                            <!-- Food Items -->
                            <div class="card">
                                <div class="card__header">
                                    <h3>قائمة الأطعمة</h3>
                                </div>
                                <div class="card__body">
                                    <div class="food-grid" id="food-grid">
                                        <!-- Food items will be populated by JavaScript -->
                                    </div>
                                </div>
                            </div>

                            <!-- Selected Foods Summary -->
                            <div class="card selected-foods-card">
                                <div class="card__header">
                                    <h3>الأطعمة المختارة</h3>
                                    <button class="btn btn--outline btn--sm" id="clear-selection">مسح الكل</button>
                                </div>
                                <div class="card__body">
                                    <div id="selected-foods-list">
                                        <p class="empty-message">لم تختر أي طعام بعد</p>
                                    </div>
                                    <div class="meal-summary" id="meal-summary" style="display: none;">
                                        <div class="summary-item">
                                            <span class="summary-label">إجمالي الكربوهيدرات:</span>
                                            <span class="summary-value" id="total-carbs">0 جرام</span>
                                        </div>
                                        <div class="summary-item">
                                            <span class="summary-label">متوسط المؤشر الجلايسيمي:</span>
                                            <span class="summary-value" id="avg-gi">0</span>
                                        </div>
                                        <div class="summary-item">
                                            <span class="summary-label">الحمل الجلايسيمي الإجمالي:</span>
                                            <span class="summary-value" id="total-gl">0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="step-actions">
                            <button type="button" class="btn btn--outline" id="back-to-step-2">← السابق</button>
                            <button type="button" class="btn btn--primary" id="calculate-btn" disabled>حساب التوقعات →</button>
                        </div>
                    </div>
                </section>

                <!-- Step 4: Results -->
                <section id="step-4" class="screen">
                    <div class="step-header">
                        <div class="step-indicator">
                            <span class="step-number">4</span>
                            <span class="step-title">النتائج والتوصيات</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 100%"></div>
                        </div>
                    </div>

                    <div class="results-container">
                        <!-- Key Metrics -->
                        <div class="metrics-grid">
                            <div class="metric-card card">
                                <div class="card__body">
                                    <div class="metric-icon">📈</div>
                                    <div class="metric-label">الذروة المتوقعة</div>
                                    <div class="metric-value" id="peak-bg">-- mg/dL</div>
                                    <div class="metric-time" id="peak-time">--</div>
                                </div>
                            </div>

                            <div class="metric-card card">
                                <div class="card__body">
                                    <div class="metric-icon">⚡</div>
                                    <div class="metric-label">الزيادة المتوقعة</div>
                                    <div class="metric-value" id="bg-increase">+-- mg/dL</div>
                                    <div class="metric-subtitle">من المستوى الحالي</div>
                                </div>
                            </div>

                            <div class="metric-card card">
                                <div class="card__body">
                                    <div class="metric-icon">💊</div>
                                    <div class="metric-label">جرعة الأنسولين</div>
                                    <div class="metric-value" id="insulin-dose">-- وحدة</div>
                                    <div class="metric-breakdown" id="insulin-breakdown">--</div>
                                </div>
                            </div>

                            <div class="metric-card card">
                                <div class="card__body">
                                    <div class="metric-icon">🚨</div>
                                    <div class="metric-label">مستوى الخطر</div>
                                    <div class="metric-value risk-indicator" id="risk-level">--</div>
                                    <div class="metric-subtitle" id="risk-description">--</div>
                                </div>
                            </div>
                        </div>

                        <!-- Blood Glucose Chart -->
                        <div class="card chart-card">
                            <div class="card__header">
                                <h3>منحنى السكر المتوقع (4 ساعات)</h3>
                            </div>
                            <div class="card__body">
                                <div class="chart-container" style="position: relative; height: 400px;">
                                    <canvas id="bg-chart"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Recommendations -->
                        <div class="card recommendations-card">
                            <div class="card__header">
                                <h3>التوصيات الشخصية</h3>
                            </div>
                            <div class="card__body">
                                <div id="recommendations-list">
                                    <!-- Recommendations will be populated by JavaScript -->
                                </div>
                            </div>
                        </div>

                        <!-- Medical Disclaimer -->
                        <div class="card disclaimer-card">
                            <div class="card__body">
                                <div class="medical-disclaimer">
                                    <h4>⚠️ إخلاء طبي مهم</h4>
                                    <p>هذه النتائج تقديرية وتعليمية فقط. لا تعدل جرعة الأنسولين دون استشارة طبيب مختص. في حالات الطوارئ، اتصل بطبيبك فوراً.</p>
                                </div>
                            </div>
                        </div>

                        <div class="step-actions">
                            <button type="button" class="btn btn--outline" id="back-to-step-3">← تعديل</button>
                            <button type="button" class="btn btn--secondary" id="save-prediction">💾 حفظ النتيجة</button>
                            <button type="button" class="btn btn--primary" id="new-calculation">حساب جديد</button>
                        </div>
                    </div>
                </section>
            </div>
        </main>

        <!-- Settings Modal -->
        <div id="settings-modal" class="modal hidden">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h3>إعدادات النظام</h3>
                    <button class="modal-close" id="close-settings">×</button>
                </div>
                <div class="modal-body">
                    <form id="settings-form">
                        <div class="form-group">
                            <label class="form-label">نسبة الأنسولين للكربوهيدرات (ICR)</label>
                            <input type="number" class="form-control" id="icr-setting" min="5" max="30" step="0.5">
                            <small>جرام كربوهيدرات لكل وحدة أنسولين</small>
                        </div>
                        <div class="form-group">
                            <label class="form-label">معامل حساسية الأنسولين (ISF)</label>
                            <input type="number" class="form-control" id="isf-setting" min="20" max="100" step="5">
                            <small>mg/dL انخفاض لكل وحدة أنسولين</small>
                        </div>
                        <div class="form-group">
                            <label class="form-label">مستوى السكر المستهدف</label>
                            <input type="number" class="form-control" id="target-bg-setting" min="80" max="140" step="5">
                            <small>mg/dL الهدف المثالي</small>
                        </div>
                        <div class="modal-actions">
                            <button type="button" class="btn btn--outline" id="reset-defaults">إعادة تعيين</button>
                            <button type="submit" class="btn btn--primary">حفظ الإعدادات</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- History Modal -->
        <div id="history-modal" class="modal hidden">
            <div class="modal-backdrop"></div>
            <div class="modal-content wide">
                <div class="modal-header">
                    <h3>سجل التنبؤات</h3>
                    <button class="modal-close" id="close-history">×</button>
                </div>
                <div class="modal-body">
                    <div id="history-content">
                        <!-- History will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Management Modal -->
        <div id="data-modal" class="modal hidden">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h3>إدارة البيانات</h3>
                    <button class="modal-close" id="close-data">×</button>
                </div>
                <div class="modal-body">
                    <div class="data-actions">
                        <div class="action-group">
                            <h4>تصدير البيانات</h4>
                            <button class="btn btn--outline" id="export-json">تصدير البيانات (JSON)</button>
                            <button class="btn btn--outline" id="export-csv">تصدير السجل (CSV)</button>
                        </div>
                        <div class="action-group">
                            <h4>استيراد البيانات</h4>
                            <input type="file" id="import-json" accept=".json" style="display: none;">
                            <input type="file" id="import-csv" accept=".csv" style="display: none;">
                            <button class="btn btn--outline" id="import-json-btn">استيراد بيانات (JSON)</button>
                            <button class="btn btn--outline" id="import-csv-btn">استيراد أطعمة (CSV)</button>
                        </div>
                        <div class="action-group danger">
                            <h4>حذف البيانات</h4>
                            <button class="btn btn--outline" id="clear-history">مسح السجل</button>
                            <button class="btn btn--outline danger" id="reset-all">إعادة تعيين كامل</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
